# å¹³é¢å›¾åˆ†æç³»ç»Ÿ - è¯¦ç»†å®æ–½æ­¥éª¤

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

æ‚¨ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„å¹³é¢å›¾æ™ºèƒ½åˆ†æç³»ç»Ÿæ¡†æ¶ï¼Œå¯ä»¥å®ç°ï¼š
1. âœ… å®¶å…·å›¾ä¾‹è¯†åˆ«ä¸ç»Ÿè®¡
2. âœ… æˆ¿é—´è¯­ä¹‰åˆ†å‰²
3. âœ… åŸºäºæ¯”ä¾‹å°ºçš„é¢ç§¯è®¡ç®—
4. âœ… å®Œæ•´çš„åˆ†æAgent

## ğŸ¯ æ¥ä¸‹æ¥çš„å…·ä½“æ­¥éª¤

### é˜¶æ®µä¸€ï¼šç¯å¢ƒæ­å»ºä¸æ•°æ®å‡†å¤‡ (ç¬¬1-2å‘¨)

#### æ­¥éª¤ 1: å®‰è£…ç¯å¢ƒ (1å¤©)

```bash
# 1. ç¡®è®¤Pythonç‰ˆæœ¬
python --version  # éœ€è¦ 3.8+

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
.\venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. éªŒè¯å®‰è£…
python -c "import torch; print(torch.__version__)"
python -c "import cv2; print(cv2.__version__)"
```

**å¯èƒ½é‡åˆ°çš„é—®é¢˜**:
- CUDAç‰ˆæœ¬ä¸åŒ¹é…ï¼šè®¿é—® https://pytorch.org/ è·å–æ­£ç¡®ç‰ˆæœ¬
- ç½‘ç»œé—®é¢˜ï¼šä½¿ç”¨å›½å†…é•œåƒ `pip install -i https://pypi.tuna.tsinghua.edu.cn/simple`

#### æ­¥éª¤ 2: å‡†å¤‡æ•°æ®é›† (1-2å‘¨)

**2.1 æ•°æ®é›†åˆ’åˆ†**

```bash
# åˆ’åˆ†è®­ç»ƒé›†/éªŒè¯é›†/æµ‹è¯•é›†
python src/utils/prepare_dataset.py \
    --images-dir data/images \
    --output-dir data/splits \
    --train-ratio 0.7 \
    --val-ratio 0.2 \
    --test-ratio 0.1
```

è¾“å‡ºï¼š
```
æ‰¾åˆ° 303 å¼ å›¾ç‰‡
è®­ç»ƒé›†: 212 å¼ 
éªŒè¯é›†: 61 å¼ 
æµ‹è¯•é›†: 30 å¼ 
```

**2.2 å¼€å§‹æ ‡æ³¨ - ç›®æ ‡æ£€æµ‹**

```bash
# å®‰è£…æ ‡æ³¨å·¥å…·
pip install labelImg

# å¯åŠ¨æ ‡æ³¨
labelImg data/images data/labels_detection
```

**æ ‡æ³¨æµç¨‹**:
1. æ‰“å¼€LabelImg
2. View â†’ Auto Save mode (å¼€å¯è‡ªåŠ¨ä¿å­˜)
3. View â†’ YOLO (é€‰æ‹©YOLOæ ¼å¼)
4. æŒ‰ `W` åˆ›å»ºçŸ©å½¢æ¡†
5. æ¡†é€‰å®¶å…·ï¼Œé€‰æ‹©ç±»åˆ«
6. æŒ‰ `D` ä¸‹ä¸€å¼ å›¾ç‰‡

**å»ºè®®çš„æ ‡æ³¨é¡ºåº**:
- ç¬¬1-3å¤©: æ ‡æ³¨20-30å¼ ï¼Œç†Ÿæ‚‰å·¥å…·å’Œæµç¨‹
- ç¬¬4-7å¤©: æ¯å¤©æ ‡æ³¨30-40å¼ 
- ç¬¬8-14å¤©: å®Œæˆå‰©ä½™æ ‡æ³¨å¹¶æ£€æŸ¥è´¨é‡

**æ ‡æ³¨æ£€æŸ¥**:
```bash
# å¯è§†åŒ–æ ‡æ³¨ç»“æœ
python scripts/visualize_dataset.py \
    --mode detection \
    --images-dir data/images \
    --labels-dir data/labels_detection \
    --num-samples 10
```

**2.3 å¼€å§‹æ ‡æ³¨ - è¯­ä¹‰åˆ†å‰²**

```bash
# å®‰è£…æ ‡æ³¨å·¥å…·
pip install labelme

# åˆ›å»ºç±»åˆ«æ–‡ä»¶
echo -e "background\nwall\nroom\ndoor_area\nwindow_area" > labels.txt

# å¯åŠ¨æ ‡æ³¨
labelme data/images --output data/labels_segmentation --labels labels.txt
```

**æ ‡æ³¨æŠ€å·§**:
- å…ˆæ ‡æ³¨æˆ¿é—´ï¼ˆæœ€é‡è¦ï¼‰
- ç„¶åæ ‡æ³¨å¢™å£
- æœ€åæ ‡æ³¨é—¨çª—åŒºåŸŸ
- ä½¿ç”¨å¤šè¾¹å½¢å·¥å…·æ²¿ç€è¾¹ç•Œç‚¹å‡»

**è½¬æ¢JSONä¸ºPNG mask** (éœ€è¦è‡ªå·±å®ç°æˆ–ä½¿ç”¨ç°æœ‰å·¥å…·)

---

### é˜¶æ®µäºŒï¼šæ¨¡å‹è®­ç»ƒ (ç¬¬3-5å‘¨)

#### æ­¥éª¤ 3: è®­ç»ƒå®¶å…·æ£€æµ‹æ¨¡å‹ (ç¬¬3å‘¨)

**3.1 æ›´æ–°é…ç½®æ–‡ä»¶**

ç¼–è¾‘ `config/furniture_detection.yaml`ï¼Œç¡®è®¤ç±»åˆ«ï¼š

```yaml
names:
  0: door
  1: window
  2: table
  3: chair
  4: bed
  # ... æ ¹æ®æ‚¨çš„æ ‡æ³¨æ·»åŠ æ‰€æœ‰ç±»åˆ«

nc: 16  # ä¿®æ”¹ä¸ºå®é™…ç±»åˆ«æ•°é‡
```

**3.2 å¼€å§‹è®­ç»ƒ**

```bash
# ä½¿ç”¨smallæ¨¡å‹è®­ç»ƒï¼ˆæ¨èï¼‰
python src/detection/train_detection.py \
    --config config/furniture_detection.yaml \
    --model-size s

# è®­ç»ƒè¿‡ç¨‹ä¼šæ˜¾ç¤ºï¼š
# Epoch   GPU_mem   box_loss   cls_loss   ...
# 1/100    3.14G     1.234      0.876      ...
```

**ç›‘æ§è®­ç»ƒ**:

```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰“å¼€TensorBoard
tensorboard --logdir runs/detect/furniture_detection
# è®¿é—® http://localhost:6006
```

**3.3 è¯„ä¼°æ¨¡å‹**

è®­ç»ƒå®Œæˆåè‡ªåŠ¨è¯„ä¼°ï¼ŒæŸ¥çœ‹æŒ‡æ ‡ï¼š
- mAP50 > 0.7: å¯ç”¨ âœ“
- mAP50 > 0.8: è‰¯å¥½ âœ“âœ“
- mAP50 > 0.9: ä¼˜ç§€ âœ“âœ“âœ“

**3.4 æµ‹è¯•æ¨ç†**

```bash
# æµ‹è¯•å•å¼ å›¾ç‰‡
python src/detection/detect_furniture.py \
    --image data/images/test.jpg \
    --model runs/detect/furniture_detection/weights/best.pt \
    --save output/test_detection.jpg \
    --json output/test_result.json
```

æŸ¥çœ‹ `output/test_detection.jpg` å’Œ `output/test_result.json`

#### æ­¥éª¤ 4: è®­ç»ƒæˆ¿é—´åˆ†å‰²æ¨¡å‹ (ç¬¬4-5å‘¨)

**4.1 å‡†å¤‡åˆ†å‰²æ•°æ®**

ç¡®ä¿ç›®å½•ç»“æ„ï¼š
```
data/
â”œâ”€â”€ images/
â””â”€â”€ labels_segmentation/
    â””â”€â”€ masks/  # PNGæ ¼å¼çš„mask
```

**4.2 è®­ç»ƒåˆ†å‰²æ¨¡å‹**

```bash
python src/segmentation/train_segmentation.py \
    --config config/room_segmentation.yaml
```

**æ³¨æ„**: å½“å‰è®­ç»ƒè„šæœ¬ä¸­çš„æ•°æ®åŠ è½½éƒ¨åˆ†éœ€è¦æ‚¨è¡¥å……å®Œæ•´ï¼ˆæ ‡è®°ä¸ºTODOï¼‰

**4.3 æµ‹è¯•åˆ†å‰²**

```bash
python src/segmentation/segment_room.py \
    --image data/images/test.jpg \
    --model models/segmentation/best_model.pth \
    --save output/test_segmentation.jpg
```

---

### é˜¶æ®µä¸‰ï¼šé›†æˆä¸æµ‹è¯• (ç¬¬6å‘¨)

#### æ­¥éª¤ 5: æ¯”ä¾‹å°ºæ ¡å‡†

**5.1 æµ‹é‡å‚è€ƒåƒç´ **

```bash
# ä½¿ç”¨æµ‹é‡å·¥å…·
python scripts/measure_pixels.py --image data/images/sample.jpg
```

æ“ä½œï¼š
1. åœ¨å›¾ä¸Šæ‰¾ä¸€æ¡å·²çŸ¥é•¿åº¦çš„çº¿æ®µï¼ˆå¦‚æ ‡æ³¨ä¸º2ç±³çš„å¢™ï¼‰
2. å·¦é”®ç‚¹å‡»çº¿æ®µä¸¤ç«¯
3. è®°å½•æ˜¾ç¤ºçš„åƒç´ è·ç¦»ï¼ˆå¦‚ 200åƒç´ ï¼‰
4. å®é™…é•¿åº¦ 2ç±³ = 200å˜ç±³

**5.2 å‡†å¤‡æ ¡å‡†å‚æ•°**

- `--reference-pixels`: 200 (åˆšæ‰æµ‹é‡çš„)
- `--reference-length`: 200 (å®é™…é•¿åº¦ï¼Œå˜ç±³)
- `--scale`: "1:100" (å¦‚æœå¹³é¢å›¾ä¸Šæœ‰æ ‡æ³¨)

#### æ­¥éª¤ 6: ä½¿ç”¨å®Œæ•´Agentåˆ†æ

**6.1 åˆ†æå•å¼ å›¾ç‰‡**

```bash
python src/agent/floorplan_agent.py \
    --image data/images/floor_plan_01.jpg \
    --scale "1:100" \
    --reference-pixels 200 \
    --reference-length 200 \
    --save-dir output/analysis_01
```

**6.2 æŸ¥çœ‹ç»“æœ**

æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶ï¼š
- `output/analysis_01/floor_plan_01_furniture.jpg` - å®¶å…·æ£€æµ‹å¯è§†åŒ–
- `output/analysis_01/floor_plan_01_segmentation.jpg` - æˆ¿é—´åˆ†å‰²å¯è§†åŒ–
- `output/analysis_01/floor_plan_01_results.json` - å®Œæ•´ç»“æœJSON

**6.3 æ‰¹é‡åˆ†æ**

åˆ›å»ºæ‰¹é‡è„šæœ¬æˆ–ä½¿ç”¨å¾ªç¯ï¼š

```powershell
# Windows PowerShell
Get-ChildItem data\images\*.jpg | ForEach-Object {
    python src/agent/floorplan_agent.py `
        --image $_.FullName `
        --scale "1:100" `
        --reference-pixels 200 `
        --reference-length 200 `
        --save-dir "output\$($_.BaseName)"
}
```

---

### é˜¶æ®µå››ï¼šä¼˜åŒ–ä¸éƒ¨ç½² (ç¬¬7-8å‘¨)

#### æ­¥éª¤ 7: æ¨¡å‹ä¼˜åŒ–

**7.1 æ€§èƒ½åˆ†æ**

```python
import time

# æµ‹è¯•æ¨ç†é€Ÿåº¦
start = time.time()
result = agent.analyze(image_path, ...)
end = time.time()

print(f"æ€»è€—æ—¶: {end - start:.2f}ç§’")
```

**7.2 åŠ é€Ÿæ–¹æ³•**

```bash
# å¯¼å‡ºä¸ºONNXæ ¼å¼
python -c "
from ultralytics import YOLO
model = YOLO('runs/detect/furniture_detection/weights/best.pt')
model.export(format='onnx')
"
```

#### æ­¥éª¤ 8: åˆ›å»ºç®€å•çš„Webç•Œé¢ï¼ˆå¯é€‰ï¼‰

```python
# webapp.py
from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse
import sys
sys.path.append('src')
from agent.floorplan_agent import FloorPlanAgent

app = FastAPI()
agent = FloorPlanAgent()

@app.get("/")
async def main():
    return HTMLResponse(content="""
    <html>
        <body>
            <h1>å¹³é¢å›¾åˆ†æç³»ç»Ÿ</h1>
            <form action="/analyze" method="post" enctype="multipart/form-data">
                <input type="file" name="file" accept="image/*">
                <input type="text" name="scale" placeholder="æ¯”ä¾‹å°º (å¦‚1:100)">
                <button type="submit">åˆ†æ</button>
            </form>
        </body>
    </html>
    """)

@app.post("/analyze")
async def analyze(file: UploadFile = File(...)):
    # ... å®ç°åˆ†æé€»è¾‘
    pass

# è¿è¡Œ: uvicorn webapp:app --reload
```

---

## ğŸ“ å­¦ä¹ è·¯å¾„å»ºè®®

### åˆå­¦è€…è·¯å¾„ (10-12å‘¨)

**ç¬¬1-2å‘¨**: åŸºç¡€å­¦ä¹ 
- å­¦ä¹ PythonåŸºç¡€
- äº†è§£æ·±åº¦å­¦ä¹ åŸºæœ¬æ¦‚å¿µ
- ç†Ÿæ‚‰OpenCVå’Œå›¾åƒå¤„ç†

**ç¬¬3-4å‘¨**: æ•°æ®å‡†å¤‡
- å­¦ä¹ ä½¿ç”¨æ ‡æ³¨å·¥å…·
- å®Œæˆ50-100å¼ å›¾ç‰‡æ ‡æ³¨
- ç†è§£YOLOå’Œè¯­ä¹‰åˆ†å‰²

**ç¬¬5-6å‘¨**: æ¨¡å‹è®­ç»ƒ
- è®­ç»ƒç¬¬ä¸€ç‰ˆæ£€æµ‹æ¨¡å‹
- è¯„ä¼°å’Œè°ƒè¯•
- å­¦ä¹ è®­ç»ƒæŠ€å·§

**ç¬¬7-8å‘¨**: å®Œå–„æ ‡æ³¨å’Œé‡è®­ç»ƒ
- æ ¹æ®ç»“æœæ”¹è¿›æ ‡æ³¨
- è®­ç»ƒåˆ†å‰²æ¨¡å‹
- ä¼˜åŒ–å‚æ•°

**ç¬¬9-10å‘¨**: é›†æˆæµ‹è¯•
- æ•´åˆæ‰€æœ‰æ¨¡å—
- æ‰¹é‡æµ‹è¯•
- ä¿®å¤bug

**ç¬¬11-12å‘¨**: ä¼˜åŒ–éƒ¨ç½²
- æ€§èƒ½ä¼˜åŒ–
- ç¼–å†™æ–‡æ¡£
- å‡†å¤‡å±•ç¤º

### è¿›é˜¶ç”¨æˆ·è·¯å¾„ (6-8å‘¨)

**ç¬¬1å‘¨**: ç¯å¢ƒæ­å»ºå’Œå¿«é€Ÿæ ‡æ³¨
**ç¬¬2-3å‘¨**: å¹¶è¡Œè®­ç»ƒä¸¤ä¸ªæ¨¡å‹
**ç¬¬4å‘¨**: é›†æˆå’Œæµ‹è¯•
**ç¬¬5-6å‘¨**: ä¼˜åŒ–å’Œæ‰©å±•åŠŸèƒ½
**ç¬¬7-8å‘¨**: éƒ¨ç½²å’Œæ–‡æ¡£

---

## ğŸ“Š æ£€æŸ¥æ¸…å•

### å¼€å‘é˜¶æ®µ

- [ ] ç¯å¢ƒå®‰è£…å®Œæˆ
- [ ] æ•°æ®é›†åˆ’åˆ†å®Œæˆ
- [ ] å®Œæˆæ£€æµ‹æ ‡æ³¨ï¼ˆè‡³å°‘100å¼ ï¼‰
- [ ] å®Œæˆåˆ†å‰²æ ‡æ³¨ï¼ˆè‡³å°‘50å¼ ï¼‰
- [ ] æ£€æµ‹æ¨¡å‹è®­ç»ƒå®Œæˆ (mAP50 > 0.7)
- [ ] åˆ†å‰²æ¨¡å‹è®­ç»ƒå®Œæˆ (mIoU > 0.6)
- [ ] æ¯”ä¾‹å°ºæ ¡å‡†æµ‹è¯•å®Œæˆ
- [ ] Agenté›†æˆæµ‹è¯•å®Œæˆ
- [ ] æ‰¹é‡å¤„ç†æµ‹è¯•å®Œæˆ

### éƒ¨ç½²é˜¶æ®µ

- [ ] æ–‡æ¡£ç¼–å†™å®Œæˆ
- [ ] å•å…ƒæµ‹è¯•å®Œæˆ
- [ ] æ€§èƒ½ä¼˜åŒ–å®Œæˆ
- [ ] ç”¨æˆ·æŒ‡å—å®Œæˆ
- [ ] æ¼”ç¤ºè§†é¢‘/PPTå®Œæˆ

---

## ğŸš¨ å¸¸è§é—®é¢˜å¿«é€Ÿå‚è€ƒ

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| æ˜¾å­˜ä¸è¶³ | å‡å°batch_size, å‡å°å›¾ç‰‡å°ºå¯¸ |
| è®­ç»ƒå¤ªæ…¢ | ä½¿ç”¨æ›´å°æ¨¡å‹, å‡å°‘epoch |
| ç²¾åº¦ä¸å¤Ÿ | å¢åŠ æ•°æ®, æ”¹å–„æ ‡æ³¨è´¨é‡ |
| æ ‡æ³¨å¤ªæ…¢ | å…ˆå°‘é‡æ ‡æ³¨, ç”¨æ¨¡å‹é¢„æ ‡æ³¨ |
| æ¯”ä¾‹å°ºä¸å‡† | å¤šæ¬¡æµ‹é‡å–å¹³å‡, ä½¿ç”¨é•¿çº¿æ®µ |

è¯¦ç»†è§£å†³æ–¹æ¡ˆè¯·æŸ¥çœ‹ [FAQæ–‡æ¡£](FAQ.md)

---

## ğŸ“ è·å–å¸®åŠ©

1. **æŸ¥çœ‹æ–‡æ¡£**:
   - [å¿«é€Ÿå¼€å§‹](../QUICKSTART.md)
   - [æ•™ç¨‹1: æ•°æ®æ ‡æ³¨](TUTORIAL_01_æ•°æ®æ ‡æ³¨æŒ‡å—.md)
   - [æ•™ç¨‹2: æ¨¡å‹è®­ç»ƒ](TUTORIAL_02_æ¨¡å‹è®­ç»ƒ.md)
   - [æ•™ç¨‹3: ä½¿ç”¨Agent](TUTORIAL_03_ä½¿ç”¨Agent.md)
   - [FAQ](FAQ.md)

2. **ä»£ç æ³¨é‡Š**: æ‰€æœ‰ä»£ç éƒ½æœ‰è¯¦ç»†æ³¨é‡Š

3. **æIssue**: åœ¨GitHubä¸Šæé—®

4. **å‚è€ƒèµ„æ–™**:
   - [YOLOv8å®˜æ–¹æ–‡æ¡£](https://docs.ultralytics.com/)
   - [PyTorchæ•™ç¨‹](https://pytorch.org/tutorials/)
   - [Segmentation Modelsæ•™ç¨‹](https://smp.readthedocs.io/)

---

## ğŸ‰ é¢„æœŸæˆæœ

å®Œæˆæœ¬é¡¹ç›®åï¼Œæ‚¨å°†è·å¾—ï¼š

1. **æŠ€æœ¯èƒ½åŠ›**:
   - âœ“ æ·±åº¦å­¦ä¹ é¡¹ç›®å¼€å‘ç»éªŒ
   - âœ“ ç›®æ ‡æ£€æµ‹å’Œè¯­ä¹‰åˆ†å‰²å®è·µ
   - âœ“ æ•°æ®æ ‡æ³¨å’Œæ¨¡å‹è®­ç»ƒç»éªŒ
   - âœ“ Pythoné¡¹ç›®å¼€å‘èƒ½åŠ›

2. **å¯äº¤ä»˜æˆæœ**:
   - âœ“ å®Œæ•´çš„å¹³é¢å›¾åˆ†æç³»ç»Ÿ
   - âœ“ è®­ç»ƒå¥½çš„æ£€æµ‹å’Œåˆ†å‰²æ¨¡å‹
   - âœ“ è¯¦ç»†çš„é¡¹ç›®æ–‡æ¡£
   - âœ“ å¯æ¼”ç¤ºçš„Demo

3. **åº”ç”¨ä»·å€¼**:
   - âœ“ å¯ç”¨äºæˆ¿åœ°äº§è¡Œä¸š
   - âœ“ å¯ç”¨äºå»ºç­‘è®¾è®¡
   - âœ“ å¯ç”¨äºå®¤å†…è®¾è®¡
   - âœ“ å¯æ‰©å±•åˆ°å…¶ä»–å›¾çº¸åˆ†æ

---

## ğŸ’ª åŠ æ²¹ï¼

è¿™æ˜¯ä¸€ä¸ªæœ‰æŒ‘æˆ˜æ€§ä½†éå¸¸æœ‰ä»·å€¼çš„é¡¹ç›®ã€‚æŒ‰ç…§æ­¥éª¤ä¸€æ­¥æ­¥æ¥ï¼Œé‡åˆ°é—®é¢˜åŠæ—¶æŸ¥é˜…æ–‡æ¡£æˆ–æé—®ï¼Œç›¸ä¿¡æ‚¨ä¸€å®šèƒ½æˆåŠŸå®Œæˆï¼

**ç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼** ğŸš€


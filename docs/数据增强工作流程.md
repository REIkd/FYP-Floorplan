# æ•°æ®å¢å¼ºå·¥ä½œæµç¨‹ - å®Œæ•´æŒ‡å—

## ğŸ¯ ç›®æ ‡

åªæ ‡æ³¨101å¼ åŸå§‹å›¾ç‰‡ï¼Œè‡ªåŠ¨ç”Ÿæˆå¢å¼ºç‰ˆæœ¬ï¼ˆé•œåƒ+æ—‹è½¬ï¼‰çš„**å›¾ç‰‡å’Œæ ‡æ³¨**ï¼Œå®ç°3å€æ•°æ®é‡ï¼

## ğŸ“Š æ•°æ®å¢å¼ºç­–ç•¥

ä»101å¼ åŸå§‹å›¾ç‰‡ç”Ÿæˆ303å¼ è®­ç»ƒæ•°æ®ï¼š

```
åŸå§‹å›¾ç‰‡ (101å¼ )
    â†“
    â”œâ”€â†’ åŸå§‹å›¾ç‰‡ (101å¼ ) â† ä½ åªéœ€æ ‡æ³¨è¿™äº›ï¼
    â”œâ”€â†’ é•œåƒå›¾ç‰‡ (101å¼ ) â† è‡ªåŠ¨ç”Ÿæˆ
    â””â”€â†’ æ—‹è½¬å›¾ç‰‡ (101å¼ ) â† è‡ªåŠ¨ç”Ÿæˆ
    
æ€»è®¡: 303å¼ å›¾ç‰‡ + 303ä¸ªæ ‡æ³¨æ–‡ä»¶
```

## ğŸš€ å®Œæ•´å·¥ä½œæµç¨‹

### æ–¹æ¡ˆAï¼šä»é›¶å¼€å§‹ï¼ˆæ¨èï¼‰

é€‚ç”¨äºï¼šä½ æœ‰åŸå§‹çš„101å¼ å›¾ç‰‡ï¼Œéœ€è¦ä»å¤´å¼€å§‹

```bash
# æ­¥éª¤1: å‡†å¤‡åŸå§‹å›¾ç‰‡
# å°†101å¼ åŸå§‹å›¾ç‰‡æ”¾åœ¨ data/images/ ç›®å½•

# æ­¥éª¤2: å¼€å§‹æ ‡æ³¨åŸå§‹å›¾ç‰‡
labelImg data/images data/labels_detection data/labels_detection/predefined_classes.txt

# æ­¥éª¤3: æ ‡æ³¨å®Œ101å¼ åï¼Œç”Ÿæˆå¢å¼ºæ•°æ®ï¼ˆå›¾ç‰‡+æ ‡æ³¨ï¼‰
python scripts/generate_augmented_dataset.py

# å®Œæˆï¼ç°åœ¨ä½ æœ‰303å¼ å›¾ç‰‡å’Œ303ä¸ªæ ‡æ³¨æ–‡ä»¶
```

### æ–¹æ¡ˆBï¼šå·²æœ‰303å¼ å›¾ç‰‡

é€‚ç”¨äºï¼šä½ å·²ç»æœ‰303å¼ å¢å¼ºåçš„å›¾ç‰‡

```bash
# æ­¥éª¤1: æå–åŸå§‹101å¼ å›¾ç‰‡
python scripts/extract_original_images.py

# æ­¥éª¤2: æ ‡æ³¨åŸå§‹å›¾ç‰‡
labelImg data/images_original data/labels_detection data/labels_detection/predefined_classes.txt

# æ­¥éª¤3: åªç”Ÿæˆæ ‡æ³¨æ–‡ä»¶ï¼ˆå› ä¸ºå›¾ç‰‡å·²å­˜åœ¨ï¼‰
python scripts/auto_generate_labels.py
```

## ğŸ“ è¯¦ç»†æ­¥éª¤è¯´æ˜

### æ­¥éª¤1: å‡†å¤‡ç¯å¢ƒ

```bash
# å®‰è£…ä¾èµ–
pip install opencv-python numpy labelImg

# ç¡®è®¤ç›®å½•ç»“æ„
data/
â”œâ”€â”€ images/                    # åŸå§‹å›¾ç‰‡ç›®å½•
â””â”€â”€ labels_detection/          # æ ‡æ³¨ä¿å­˜ç›®å½•
    â””â”€â”€ predefined_classes.txt # é¢„å®šä¹‰ç±»åˆ«
```

### æ­¥éª¤2: æ ‡æ³¨åŸå§‹å›¾ç‰‡

```bash
# å¯åŠ¨ LabelImgï¼ˆå¸¦é¢„å®šä¹‰ç±»åˆ«ï¼‰
labelImg data/images data/labels_detection data/labels_detection/predefined_classes.txt

# æ ‡æ³¨æŠ€å·§ï¼š
# - åªæ ‡æ³¨åŸå§‹çš„101å¼ 
# - ä¸ç”¨æ‹…å¿ƒå¢å¼ºç‰ˆæœ¬
# - ä½¿ç”¨å¿«æ·é”®æé«˜æ•ˆç‡ï¼ˆWåˆ›å»ºæ¡†ï¼ŒDä¸‹ä¸€å¼ ï¼‰
```

### æ­¥éª¤3: ç”Ÿæˆå¢å¼ºæ•°æ®

#### åŸºæœ¬ç”¨æ³•

```bash
# é»˜è®¤ï¼šä» data/images è¯»å–åŸå§‹å›¾ç‰‡ï¼Œç”Ÿæˆå¢å¼ºç‰ˆæœ¬åˆ°åŒç›®å½•
python scripts/generate_augmented_dataset.py
```

#### é«˜çº§é€‰é¡¹

```bash
# å¼ºåˆ¶é‡æ–°ç”Ÿæˆï¼ˆè¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶ï¼‰
python scripts/generate_augmented_dataset.py --force

# æŒ‡å®šè‡ªå®šä¹‰ç›®å½•
python scripts/generate_augmented_dataset.py \
    --images-dir data/images_original \
    --labels-dir data/labels_detection \
    --output-images data/images_augmented \
    --output-labels data/labels_detection

# åªå¤„ç†å‰50å¼ ï¼ˆæµ‹è¯•ç”¨ï¼‰
python scripts/generate_augmented_dataset.py --max-number 50
```

## ğŸ”§ å¢å¼ºç»†èŠ‚

### æ°´å¹³ç¿»è½¬ï¼ˆé•œåƒï¼‰

**å›¾ç‰‡å˜æ¢ï¼š**
```
åŸå§‹å›¾ç‰‡          é•œåƒå›¾ç‰‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [é—¨]    â”‚  â†’   â”‚    [é—¨] â”‚
â”‚         â”‚      â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ‡æ³¨å˜æ¢ï¼š**
```python
# åæ ‡å˜æ¢å…¬å¼
new_x = 1 - x
new_y = y
new_width = width
new_height = height
```

**ç¤ºä¾‹ï¼š**
```
åŸå§‹æ ‡æ³¨: 0 0.2 0.5 0.1 0.2  (é—¨åœ¨å·¦ä¾§)
é•œåƒæ ‡æ³¨: 0 0.8 0.5 0.1 0.2  (é—¨å˜åˆ°å³ä¾§)
```

### æ—‹è½¬90åº¦ï¼ˆé€†æ—¶é’ˆï¼‰

**å›¾ç‰‡å˜æ¢ï¼š**
```
åŸå§‹å›¾ç‰‡          æ—‹è½¬å
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”
â”‚ [é—¨]    â”‚      â”‚   â”‚
â”‚         â”‚  â†’   â”‚   â”‚
â”‚         â”‚      â”‚[é—¨]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”˜
```

**æ ‡æ³¨å˜æ¢ï¼š**
```python
# åæ ‡å’Œå°ºå¯¸éƒ½éœ€è¦å˜æ¢
new_x = y
new_y = 1 - x
new_width = height   # å®½é«˜äº’æ¢
new_height = width
```

**ç¤ºä¾‹ï¼š**
```
åŸå§‹æ ‡æ³¨: 0 0.2 0.3 0.1 0.15
æ—‹è½¬æ ‡æ³¨: 0 0.3 0.8 0.15 0.1
```

## ğŸ“‚ ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

```
data/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ FloorPlan-1-xxx.jpg                    # åŸå§‹å›¾ç‰‡
â”‚   â”œâ”€â”€ FloorPlan-1-xxx_flip.jpg              # é•œåƒå›¾ç‰‡ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ FloorPlan-1-xxx_rot90.jpg             # æ—‹è½¬å›¾ç‰‡ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ FloorPlan-2-xxx.jpg
â”‚   â”œâ”€â”€ FloorPlan-2-xxx_flip.jpg
â”‚   â”œâ”€â”€ FloorPlan-2-xxx_rot90.jpg
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ labels_detection/
    â”œâ”€â”€ predefined_classes.txt                 # é¢„å®šä¹‰ç±»åˆ«
    â”œâ”€â”€ classes.txt                            # YOLOç±»åˆ«æ–‡ä»¶
    â”œâ”€â”€ FloorPlan-1-xxx.txt                   # åŸå§‹æ ‡æ³¨
    â”œâ”€â”€ FloorPlan-1-xxx_flip.txt              # é•œåƒæ ‡æ³¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    â”œâ”€â”€ FloorPlan-1-xxx_rot90.txt             # æ—‹è½¬æ ‡æ³¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    â””â”€â”€ ...
```

## ğŸ”„ å¢é‡æ›´æ–°å·¥ä½œæµ

å¢å¼ºè„šæœ¬æ”¯æŒå¢é‡æ›´æ–°ï¼Œå¯ä»¥åˆ†æ‰¹æ ‡æ³¨ï¼š

```bash
# ç¬¬1å¤©ï¼šæ ‡æ³¨å‰10å¼ 
labelImg data/images data/labels_detection data/labels_detection/predefined_classes.txt

# ç”Ÿæˆè¿™10å¼ çš„å¢å¼ºæ•°æ®ï¼ˆå…±30å¼ ï¼‰
python scripts/generate_augmented_dataset.py

# ç¬¬2å¤©ï¼šç»§ç»­æ ‡æ³¨ç¬¬11-20å¼ 
labelImg data/images data/labels_detection data/labels_detection/predefined_classes.txt

# å†æ¬¡è¿è¡Œï¼Œåªç”Ÿæˆæ–°çš„å¢å¼ºæ•°æ®ï¼ˆå…±60å¼ ï¼‰
python scripts/generate_augmented_dataset.py

# ç»§ç»­ç›´åˆ°å®Œæˆå…¨éƒ¨101å¼ ...
```

## âœ… éªŒè¯å¢å¼ºæ•ˆæœ

### 1. ç»Ÿè®¡æ–‡ä»¶æ•°é‡

```bash
# Windows PowerShell
(Get-ChildItem data\images\*.jpg).Count
(Get-ChildItem data\labels_detection\*.txt).Count

# Linux/Mac
ls data/images/*.jpg | wc -l
ls data/labels_detection/*.txt | wc -l

# æœŸæœ›ç»“æœï¼š303å¼ å›¾ç‰‡ï¼Œ303ä¸ªæ ‡æ³¨æ–‡ä»¶ï¼ˆ+2ä¸ªé…ç½®æ–‡ä»¶ï¼‰
```

### 2. å¯è§†åŒ–æ£€æŸ¥

```bash
# ä½¿ç”¨å¯è§†åŒ–å·¥å…·æ£€æŸ¥æ ‡æ³¨æ˜¯å¦æ­£ç¡®
python scripts/visualize_dataset.py

# é‡ç‚¹æ£€æŸ¥ï¼š
# - é•œåƒå›¾ç‰‡çš„æ ‡æ³¨ä½ç½®æ˜¯å¦å·¦å³å¯¹ç§°
# - æ—‹è½¬å›¾ç‰‡çš„æ ‡æ³¨ä½ç½®å’Œå°ºå¯¸æ˜¯å¦æ­£ç¡®
```

### 3. å¯¹æ¯”æ£€æŸ¥

```python
# åˆ›å»ºæ£€æŸ¥è„šæœ¬
python -c "
import cv2
import numpy as np

# è¯»å–åŸå§‹ã€é•œåƒã€æ—‹è½¬å›¾ç‰‡
img_orig = cv2.imread('data/images/FloorPlan-1-xxx.jpg')
img_flip = cv2.imread('data/images/FloorPlan-1-xxx_flip.jpg')
img_rot = cv2.imread('data/images/FloorPlan-1-xxx_rot90.jpg')

# æ£€æŸ¥é•œåƒæ˜¯å¦æ­£ç¡®
img_flip_check = cv2.flip(img_orig, 1)
diff_flip = np.abs(img_flip.astype(float) - img_flip_check.astype(float)).mean()
print(f'é•œåƒå·®å¼‚: {diff_flip:.2f} (æ¥è¿‘0è¡¨ç¤ºæ­£ç¡®)')

# æ£€æŸ¥æ—‹è½¬æ˜¯å¦æ­£ç¡®
img_rot_check = cv2.rotate(img_orig, cv2.ROTATE_90_COUNTERCLOCKWISE)
if img_rot.shape == img_rot_check.shape:
    diff_rot = np.abs(img_rot.astype(float) - img_rot_check.astype(float)).mean()
    print(f'æ—‹è½¬å·®å¼‚: {diff_rot:.2f} (æ¥è¿‘0è¡¨ç¤ºæ­£ç¡®)')
"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç£ç›˜ç©ºé—´

```
åŸå§‹æ•°æ®: 101å¼  Ã— 2MB = 202MB
å¢å¼ºæ•°æ®: 303å¼  Ã— 2MB = 606MB
å»ºè®®é¢„ç•™: 1GB ä»¥ä¸Š
```

### 2. å¤„ç†æ—¶é—´

```
å•å¼ å›¾ç‰‡å¤„ç†æ—¶é—´: ~0.5ç§’
101å¼  Ã— 2æ¬¡å¢å¼º = çº¦2åˆ†é’Ÿ
```

### 3. è¦†ç›–ä¿æŠ¤

- é»˜è®¤æƒ…å†µä¸‹ï¼Œè„šæœ¬**ä¸ä¼šè¦†ç›–**å·²å­˜åœ¨çš„æ–‡ä»¶
- ä½¿ç”¨ `--force` å‚æ•°å¯ä»¥å¼ºåˆ¶é‡æ–°ç”Ÿæˆ
- å»ºè®®æ ‡æ³¨å®Œæˆåå†è¿è¡Œå¢å¼ºè„šæœ¬

### 4. æ ‡æ³¨è´¨é‡

```
âœ… ç¡®ä¿åŸå§‹æ ‡æ³¨å‡†ç¡®ï¼Œå› ä¸ºå¢å¼ºæ ‡æ³¨åŸºäºåŸå§‹æ ‡æ³¨
âœ… ç‰¹åˆ«æ³¨æ„ä¸å¯¹ç§°çš„ç‰©ä½“ï¼ˆå¦‚æ–‡å­—ã€æ–¹å‘æ€§æ ‡è¯†ï¼‰
âœ… å»ºè®®æŠ½æŸ¥å‡ å¼ å¢å¼ºå›¾ç‰‡çš„æ ‡æ³¨æ•ˆæœ
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç”Ÿæˆçš„å¢å¼ºå›¾ç‰‡æ˜¯é»‘è‰²çš„ï¼Ÿ

**åŸå› ï¼š** å›¾ç‰‡è·¯å¾„é”™è¯¯æˆ–æ ¼å¼ä¸æ”¯æŒ

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å­˜åœ¨
ls data/images/FloorPlan-1*.jpg

# å°è¯•ä¸åŒçš„å›¾ç‰‡æ ¼å¼
python scripts/generate_augmented_dataset.py --images-dir data/images
```

### Q2: å¢å¼ºæ ‡æ³¨ä½ç½®ä¸å¯¹ï¼Ÿ

**åŸå› ï¼š** å¯èƒ½åŸå§‹æ ‡æ³¨æœ‰è¯¯æˆ–åæ ‡å˜æ¢é”™è¯¯

**è§£å†³ï¼š**
1. æ£€æŸ¥åŸå§‹æ ‡æ³¨æ˜¯å¦æ­£ç¡®
2. ä½¿ç”¨å¯è§†åŒ–å·¥å…·éªŒè¯
3. å¦‚å‘ç°é—®é¢˜ï¼Œä½¿ç”¨ `--force` é‡æ–°ç”Ÿæˆ

### Q3: éƒ¨åˆ†å›¾ç‰‡æ²¡æœ‰ç”Ÿæˆå¢å¼ºç‰ˆæœ¬ï¼Ÿ

**åŸå› ï¼š** åŸå§‹å›¾ç‰‡ä¸å­˜åœ¨æˆ–æ–‡ä»¶åæ ¼å¼ä¸åŒ¹é…

**è§£å†³ï¼š**
```bash
# æŸ¥çœ‹è„šæœ¬è¾“å‡ºï¼Œæ‰¾åˆ°è­¦å‘Šä¿¡æ¯
python scripts/generate_augmented_dataset.py 2>&1 | grep "æœªæ‰¾åˆ°"

# æ£€æŸ¥æ–‡ä»¶å‘½åæ˜¯å¦ç¬¦åˆ FloorPlan-N-xxx.jpg æ ¼å¼
```

### Q4: å¦‚ä½•é‡æ–°ç”Ÿæˆç‰¹å®šå›¾ç‰‡çš„å¢å¼ºç‰ˆæœ¬ï¼Ÿ

**è§£å†³ï¼š**
```bash
# åˆ é™¤è¦é‡æ–°ç”Ÿæˆçš„æ–‡ä»¶
rm data/images/FloorPlan-5*_flip.jpg
rm data/images/FloorPlan-5*_rot90.jpg
rm data/labels_detection/FloorPlan-5*_flip.txt
rm data/labels_detection/FloorPlan-5*_rot90.txt

# é‡æ–°è¿è¡Œè„šæœ¬
python scripts/generate_augmented_dataset.py
```

## ğŸ“Š ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **æ–¹æ¡ˆA: ç”Ÿæˆå¢å¼ºæ•°æ®** | çœŸå®çš„æ•°æ®å¢å¼º<br>æ–‡ä»¶åæ¸…æ™°<br>æ˜“äºç®¡ç† | å ç”¨æ›´å¤šç£ç›˜ç©ºé—´ | ä»é›¶å¼€å§‹æ ‡æ³¨ |
| æ–¹æ¡ˆB: åªç”Ÿæˆæ ‡æ³¨ | èŠ‚çœç£ç›˜ç©ºé—´<br>é€‚ç”¨äºå·²æœ‰å¢å¼ºå›¾ç‰‡ | éœ€è¦å·²æœ‰å¢å¼ºå›¾ç‰‡<br>æ–‡ä»¶åéœ€è¦åŒ¹é… | å·²æœ‰303å¼ å›¾ç‰‡ |
| æ–¹æ¡ˆC: è®­ç»ƒæ—¶å¢å¼º | æœ€èŠ‚çœç©ºé—´<br>å¯ä»¥æœ‰æ— é™å˜åŒ– | è®­ç»ƒé€Ÿåº¦æ…¢<br>ä¸å¯é‡ç° | æ•°æ®é‡å¾ˆå°‘æ—¶ |

**æ¨èï¼šæ–¹æ¡ˆAï¼ˆæœ¬æ–‡æ¡£æ–¹æ¡ˆï¼‰**

## ğŸš€ ä¸‹ä¸€æ­¥

å¢å¼ºæ•°æ®ç”Ÿæˆå®Œæˆåï¼š

```bash
# 1. å‡†å¤‡è®­ç»ƒæ•°æ®é›†
python src/utils/prepare_dataset.py --images-dir data/images

# 2. å¼€å§‹è®­ç»ƒæ¨¡å‹
python src/detection/train_detection.py

# 3. æµ‹è¯•æ¨¡å‹æ•ˆæœ
python src/detection/detect_furniture.py --image test.jpg
```

## ğŸ“Œ å¿«é€Ÿå‚è€ƒ

```bash
# å®Œæ•´å·¥ä½œæµï¼ˆ3æ­¥èµ°ï¼‰
labelImg data/images data/labels_detection data/labels_detection/predefined_classes.txt
python scripts/generate_augmented_dataset.py
python src/utils/prepare_dataset.py

# å¼ºåˆ¶é‡æ–°ç”Ÿæˆ
python scripts/generate_augmented_dataset.py --force

# æŸ¥çœ‹å¸®åŠ©
python scripts/generate_augmented_dataset.py --help
```

---

**å®Œæ•´çš„æ•°æ®å¢å¼ºï¼Œ3å€è®­ç»ƒæ•°æ®ï¼Œåªéœ€æ ‡æ³¨101å¼ ï¼** ğŸ‰

